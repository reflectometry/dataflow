<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>Plot from Dataflow</title>
        <!-- JQPLOT -->
        <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/start/jquery-ui.css" type="text/css" rel="Stylesheet" />
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/jquery-ui.min.js" type="text/javascript"></script>
    <!--		<script type="text/javascript" src="../static/lib/plotting/jqplot/jquery-1.5.1.js"></script>-->
        <script type="text/javascript" src="../static/lib/plotting/jqplot/jquery.jqplot.js"></script>
        <script type="text/javascript" src="../static/lib/plotting/jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>
        <script type="text/javascript" src="../static/lib/plotting/jqplot/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
        <script type="text/javascript" src="../static/lib/plotting/jqplot/plugins/jqplot.canvasAxisTickRenderer.min.js"></script>
        <script type="text/javascript" src="../static/lib/plotting/jqplot/plugins/jqplot.errorbarRenderer.js"></script>
        <script type="text/javascript" src="../static/lib/plotting/jqplot/plugins/jqplot.cursor.js"></script>
        <script type="text/javascript" src="../static/lib/plotting/jqplot/jqplot.FixedAspect.js"></script>
        <script type="text/javascript" src="../static/lib/plotting/jqplot/jquery.jqplot.InteractiveLegend.js"></script>
        <script type="text/javascript" src="../static/lib/plotting/jqplot/plugins/jqplot.mobile.js"></script>
        <script type="text/javascript" src="../static/lib/plotting/palettes.js"></script>
        <script type="text/javascript" src="../static/lib/plotting/plotting_api.js"></script>
        <script type="text/javascript" src="../static/lib/plotting/heatmapRenderer.js"></script>
        <script type="text/javascript" src="../static/lib/plotting/colorbarRenderer.js"></script>
        <!-- Interactors -->
        <script type="text/javascript" src="../static/lib/interactors/interactors_nonprototype.js"></script>
        <script type="text/javascript" src="../static/lib/interactors/interactor_plugin_base.js"></script>
        <script type="text/javascript" src="../static/lib/interactors/rectangle_interactor_plugin.js"></script>

        <!-- EXTJS -->
        <script type="text/javascript" src="../static/lib/ext/ext-all.js"></script>

        <!-- Uniq Array -->
        <script type="text/javascript" src="../static/lib/UniqArray.js"></script>
        <script type="text/javascript" src="../static/lib/js-object-length.js"></script>
        <style>
            /* Comment Module */
            div.WireIt-Container.WiringEditor-module-comment {
                width: 200px;
            }
            div.WireIt-Container.WiringEditor-module-comment div.body {
                background-color: #EEEE66;
            }
            div.WireIt-Container.WiringEditor-module-comment div.body textarea {
                background-color: transparent;
                font-weight: bold;
                border: 0;
            }
            .jqplot-table-legend-swatch {
                width: 10;
                height: 10;
            }
            .show_hide {
                display:none;
            }
            .metadata-label {color: red}
            .slidingDiv {
                background-color: #99CCFF;
                padding:20px;
                margin-top:10px;
                border-bottom:5px solid #3399FF;
            }
        </style>
        <script type="text/javascript">
            window.onload = function() {
                debug = false;
                if (window.opener.toPlot) {
                    var plotgrid = makePlotSelector(window.opener.toPlot);
                    plottingAPI(window.opener.toPlot, 'plot');   
                }

                jQuery(".slidingDiv").hide();
                jQuery('.show_hide').click(function(){
                    jQuery(".slidingDiv").slideToggle();
                });
            };

            function makePlotSelector(toPlot) {
                /* Creates the plotgrid by instantiating the columns and store based on the passed objects */

                //Creating store and grid.
                var storeFields = [{name: 'Files'}, {name: 'Legend'}];
                Ext.regModel('fileModel', {
                    fields: storeFields
                });
                var store = Ext.create('Ext.data.Store', { model: 'fileModel'});
                var myCheckboxModel = new Ext.selection.CheckboxModel(); //just a reference, can override

                //add all files to the store..
                var filerecs=[];
                for (var j = 0; j < toPlot.length; ++j) {
                    var filerec = {};
                    filerec['Files'] = toPlot[j].series[0].label;
                    filerec['Legend'] = NaN;            //NaN for now... TODO
                    filerec['toPlotObj'] = toPlot[j];   //hidden field
                    filerecs.push(filerec);
                }

                //TODO setup renderer for 'Legend'
                var gridColumns = [];
                gridColumns.push({header: 'Files', width: 150, sortable: true, dataIndex: 'Files'});
                gridColumns.push({header: 'Legend', width: 75, sortable: false, dataIndex: 'Legend'});
                gridColumns.push({header: 'toPlotObj', hidden: true, sortable: false, dataIndex: 'toPlotObj'});
                store.loadData(filerecs);

                /* GridPanel that displays the data. */
                var plotgrid = new Ext.grid.GridPanel({
                    store: store,
                    selModel: myCheckboxModel,
                    columns: gridColumns,
                    stripeRows: true,
                    fieldLabel: 'plotpanel',
                    height: 300,
                    autoWidth: true,
                    title: 'Select the files to plot:',
                });

                return plotgrid;
            }

        </script>
    </head>
    <body id="woot" class="yui-skin-sam">
        <div id="plot">
            I am a plot.
        </div>
    </body>
</html>
